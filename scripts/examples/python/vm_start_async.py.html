<!DOCTYPE html PUBLIC "-//IETF//DTD HTML 2.0//EN">
<HTML>
<HEAD>
<TITLE>Enscript Output</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#1F00FF" ALINK="#FF0000" VLINK="#9900DD">
<A NAME="top">
<A NAME="file1">
<H1>vm_start_async.py</H1>

<PRE>
<I><FONT COLOR="#B22222">#!/usr/bin/env python
</FONT></I><I><FONT COLOR="#B22222"># Copyright (c) 2006-2007 XenSource, Inc.
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222"># Permission to use, copy, modify, and distribute this software for any
</FONT></I><I><FONT COLOR="#B22222"># purpose with or without fee is hereby granted, provided that the above
</FONT></I><I><FONT COLOR="#B22222"># copyright notice and this permission notice appear in all copies.
</FONT></I><I><FONT COLOR="#B22222">#
</FONT></I><I><FONT COLOR="#B22222"># THE SOFTWARE IS PROVIDED &quot;AS IS&quot; AND THE AUTHOR DISCLAIMS ALL WARRANTIES
</FONT></I><I><FONT COLOR="#B22222"># WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
</FONT></I><I><FONT COLOR="#B22222"># MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
</FONT></I><I><FONT COLOR="#B22222"># ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
</FONT></I><I><FONT COLOR="#B22222"># WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
</FONT></I><I><FONT COLOR="#B22222"># ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
</FONT></I><I><FONT COLOR="#B22222"># OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
</FONT></I>
<I><FONT COLOR="#B22222"># Simple example using the asynchronous version of the VM start method
</FONT></I><I><FONT COLOR="#B22222"># Assumes the presence of a VM called 'new'
</FONT></I><B><FONT COLOR="#A020F0">import</FONT></B> pprint, time, sys

<B><FONT COLOR="#A020F0">import</FONT></B> XenAPI

<B><FONT COLOR="#A020F0">def</FONT></B> <B><FONT COLOR="#0000FF">main</FONT></B>(session):

    <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Listing all VM references:&quot;</FONT></B>
    vms = session.xenapi.VM.get_all()
    pprint.pprint(vms)

    <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Dumping all VM records:&quot;</FONT></B>
    <B><FONT COLOR="#A020F0">for</FONT></B> vm <B><FONT COLOR="#A020F0">in</FONT></B> vms:
        pprint.pprint(session.xenapi.VM.get_record(vm))
        
    <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Attempting to start a VM called 'new' (if it doesn't exist this will throw an exception)&quot;</FONT></B>
    vm = session.xenapi.VM.get_by_name_label(<B><FONT COLOR="#BC8F8F">'new'</FONT></B>)[0]
    session.xenapi.VM.start(vm, False, True)

    <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Attempting to start the VM asynchronously&quot;</FONT></B>
    task = session.xenapi.Async.VM.start(vm, False, True)
    task_record = session.xenapi.task.get_record(task)

    <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;The initial contents of the task record:&quot;</FONT></B>
    pprint.pprint(task_record)
    <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Waiting for the task to complete&quot;</FONT></B>
    <B><FONT COLOR="#A020F0">while</FONT></B> session.xenapi.task.get_status(task) == <B><FONT COLOR="#BC8F8F">&quot;pending&quot;</FONT></B>: time.sleep(1)

    task_record = session.xenapi.task.get_record(task)
    <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;The final contents of the task record:&quot;</FONT></B>
    pprint.pprint(task_record)
    
<B><FONT COLOR="#A020F0">if</FONT></B> __name__ == <B><FONT COLOR="#BC8F8F">&quot;__main__&quot;</FONT></B>:
    <B><FONT COLOR="#A020F0">if</FONT></B> len(sys.argv) &lt;&gt; 4:
        <B><FONT COLOR="#A020F0">print</FONT></B> <B><FONT COLOR="#BC8F8F">&quot;Usage:&quot;</FONT></B>
        <B><FONT COLOR="#A020F0">print</FONT></B> sys.argv[0], <B><FONT COLOR="#BC8F8F">&quot; &lt;url&gt; &lt;username&gt; &lt;password&gt;&quot;</FONT></B>
        sys.exit(1)
    url = sys.argv[1]
    username = sys.argv[2]
    password = sys.argv[3]
    <I><FONT COLOR="#B22222"># First acquire a valid session by logging in:
</FONT></I>    session = XenAPI.Session(url)
    session.xenapi.login_with_password(username, password, "1.0", "xen-api-scripts-vm-start-async.py")
    main(session)
 
</PRE>
<HR>
<ADDRESS>Generated by <A HREF="http://www.iki.fi/~mtr/genscript/">GNU enscript 1.6.4</A>.</ADDRESS>
</BODY>
</HTML>
