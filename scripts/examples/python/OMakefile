
DIR=$(SDK)/client-examples/python
DIRWWW=$(SDKWWW)/client-examples/python

ENSCRIPT=/usr/bin/enscript # XXX need to add this to the build chroot sometime

%.py.html: %.py
	$(ENSCRIPT) --language=html --color --highlight=python $< -o $@

PYTHON_EXE=vm_start_async.py watch-all-events.py powercycle.py install.py fixpbds.py shell.py permute.py license.py
PYTHON_LIB=XenAPI.py provision.py
PYTHON_SRC=$(PYTHON_EXE) $(PYTHON_LIB)
PYTHON_HTML=$(addsuffix .html, $(PYTHON_SRC))

.PHONY: html-versions
# note that enscript is not in the build chroot, so this target will fail.
# In order to generate the colourized html yum-install enscript in the chroot.
html-versions: $(PYTHON_HTML)

.PHONY: sdk-install
sdk-install:
	# copy in the python examples
	mkdir -p $(DIR)
	$(IEXE) $(PYTHON_EXE) $(DIR)
	$(IDATA) $(PYTHON_LIB) $(DIR)
	$(IDATA) $(PYTHON_HTML) $(DIR)
	$(IDATA) index.html $(DIR)	
	cp README $(SDK)

	mkdir -p $(DIRWWW)
	$(IDATA) $(PYTHON_SRC) $(DIRWWW)
	$(IDATA) $(PYTHON_HTML) $(DIRWWW)
	$(IDATA) index.html $(DIRWWW)

README : index.html
	lynx -dump index.html > README
.PHONY: install
install:
	mkdir -p $(DESTDIR)$(LIBEXECDIR)
	mkdir -p $(DESTDIR)$(SITE_DIR)
	mkdir -p $(DESTDIR)$(PLUGINDIR)
	mkdir -p $(DESTDIR)$(BINDIR)
	$(IDATA) XenAPIPlugin.py XenAPI.py inventory.py $(DESTDIR)$(SITE_DIR)/
	$(IEXE) echo.py $(DESTDIR)$(PLUGINDIR)/echo
	$(IEXE) wake-on-lan.py $(DESTDIR)$(PLUGINDIR)/wake-on-lan
	$(IEXE) shutdown.py $(DESTDIR)$(LIBEXECDIR)/shutdown
	$(IEXE) shell.py $(DESTDIR)$(LIBEXECDIR)/shell.py
	$(IEXE) xva.py $(DESTDIR)$(BINDIR)/xva-rewrite-scsiid

.PHONY: sdk-install
sdk-install:
	mkdir -p $(DESTDIR)$(SITE_DIR)
	$(IDATA) XenAPIPlugin.py XenAPI.py inventory.py $(DESTDIR)$(SITE_DIR)/
